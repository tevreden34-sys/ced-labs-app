<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Control Hub</title>
  <style>
    :root{--bg:#0b0f17;--panel:#121a26;--panel2:#0f1622;--line:#223044;--text:#ecf3ff;--muted:#8ea2bd;--green:#19c37d;--red:#ff5f7a;--amber:#f9b949}
    *{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui,Arial,sans-serif;color:var(--text);background:radial-gradient(1200px 500px at 20% -10%,#19263b 0%,transparent 45%),var(--bg)}
    .wrap{max-width:1200px;margin:0 auto;padding:22px}.header{display:flex;align-items:flex-end;justify-content:space-between;gap:12px;flex-wrap:wrap;margin-bottom:16px}
    h1{font-size:30px;margin:0}.sub{margin:4px 0 0;color:var(--muted);font-size:14px}.statusbar{display:flex;gap:8px;flex-wrap:wrap}
    .chip{background:var(--panel2);border:1px solid var(--line);padding:8px 10px;border-radius:999px;font-size:12px;color:var(--muted)}
        .card{background:linear-gradient(180deg,var(--panel),var(--panel2));border:1px solid var(--line);border-radius:16px;overflow:hidden;margin-bottom:14px}
    .card-head{padding:14px 16px;border-bottom:1px solid var(--line);display:flex;justify-content:space-between;align-items:center}.card-title{font-weight:700}
    .card-body{padding:10px 14px 14px}
    table{width:100%;border-collapse:collapse}th,td{padding:11px 10px;border-bottom:1px solid #1c293a;font-size:14px}th{font-size:12px;text-transform:uppercase;color:#9eb2cf;text-align:left}
    tbody tr:last-child td{border-bottom:none}tbody tr:hover{background:rgba(90,168,255,.04)}.coin{display:flex;align-items:center;gap:10px;font-weight:600}.coin img{width:22px;height:22px;border-radius:50%}
    .num{text-align:right}.up{color:var(--green);font-weight:700}.down{color:var(--red);font-weight:700}.loading{padding:28px;text-align:center;color:var(--muted)}
    .narratives{display:grid;grid-template-columns:repeat(5,minmax(0,1fr));gap:12px}.n-card{border:1px solid #27364b;background:#0f1623;border-radius:14px;padding:12px;transition:.2s}
    .n-card:hover{transform:translateY(-2px);border-color:#375177}.n-title{font-weight:700;margin-bottom:6px}.n-desc{color:var(--muted);font-size:13px;line-height:1.35;min-height:36px}
    .tokens{display:flex;flex-wrap:wrap;gap:6px;margin:10px 0}.token{font-size:12px;border:1px solid #30435f;background:#132034;padding:4px 7px;border-radius:999px;color:#b8c9e0}
    .meta{display:flex;justify-content:space-between;align-items:center}.sent{font-size:12px;padding:4px 8px;border-radius:999px}
    .bull{color:#2ddd92;background:rgba(25,195,125,.12)}.neutral{color:#ffd381;background:rgba(249,185,73,.12)}.bear{color:#ff8ea0;background:rgba(255,95,122,.12)}
    .strength{font-size:12px;color:#ffb35a}
    @media (max-width:1020px){.narratives{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media (max-width:680px){.wrap{padding:14px}h1{font-size:24px}th:nth-child(4),td:nth-child(4){display:none}.narratives{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <main class="wrap">
    <section class="header">
      <div><h1>Control Hub</h1><p class="sub">Crypto intelligence dashboard Â· live market + Solana narrative pulse</p></div>
      <div class="statusbar">
        <div class="chip" id="cgStatus">CoinGecko: connectingâ€¦</div>
                <div class="chip" id="lastSync">Last sync: --:--:--</div>
      </div>
    </section>

    <article class="card">
      <div class="card-head"><div class="card-title">Top 10 Crypto Market</div><div class="sub" style="margin:0">Auto refresh: 2s</div></div>
      <div class="card-body"><div id="tableWrap" class="loading">Loading top 10 assetsâ€¦</div></div>
    </article>

    <article class="card">
      <div class="card-head"><div class="card-title">Top 5 Solana DEX Narratives</div><div class="sub" id="narrativeTick" style="margin:0">Next rotation: 12s</div></div>
      <div class="card-body"><div id="narratives" class="narratives"></div></div>
    </article>
  </main>

  <script>
    const tableWrap=document.getElementById('tableWrap'),cgStatus=document.getElementById('cgStatus'),lastSync=document.getElementById('lastSync');
    const narrativesEl=document.getElementById('narratives'),narrativeTick=document.getElementById('narrativeTick');
    const BASE_MS=2000,MAX_MS=60000; let refreshMs=BASE_MS,pollTimer;
    const endpoint='https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=10&page=1&sparkline=false&price_change_percentage=24h';

    const fallback=[
      ['bitcoin','BTC',97000,2.1,1910000000000],['ethereum','ETH',5200,1.3,625000000000],['tether','USDT',1.0,0.0,140000000000],
      ['solana','SOL',245,3.4,115000000000],['bnb','BNB',740,0.7,109000000000],['xrp','XRP',1.8,-0.8,104000000000],
      ['dogecoin','DOGE',0.39,5.6,57000000000],['cardano','ADA',1.12,1.0,40000000000],['tron','TRX',0.24,-0.6,21000000000],['avalanche-2','AVAX',55,2.0,23000000000]
    ].map((x,i)=>({id:x[0],symbol:x[1],name:x[0].replace('-',' ').replace(/\b\w/g,m=>m.toUpperCase()),image:`https://coin-images.coingecko.com/coins/images/${i+1}/large/icon.png`,current_price:x[2],price_change_percentage_24h:x[3],market_cap:x[4]}));

    function fmtMoney(v){const n=Number(v||0);return '$'+n.toLocaleString(undefined,n<1?{minimumFractionDigits:4,maximumFractionDigits:6}:{minimumFractionDigits:2,maximumFractionDigits:2})}
    const fmtCap=v=>'$'+Number(v||0).toLocaleString();
    const fmtPct=v=>`<span class="${v>=0?'up':'down'}">${v>=0?'+':''}${Number(v).toFixed(2)}%</span>`;

    function renderTable(data){
      tableWrap.className='';
      tableWrap.innerHTML=`<table><thead><tr><th>#</th><th>Asset</th><th class="num">Price</th><th class="num">24h</th><th class="num">Market Cap</th></tr></thead><tbody>${data.map((c,i)=>`<tr><td>${i+1}</td><td><div class="coin"><img src="${c.image}" alt="${c.symbol}" onerror="this.style.display='none'"><span>${c.name} <span style="color:var(--muted)">(${String(c.symbol).toUpperCase()})</span></span></div></td><td class="num">${fmtMoney(c.current_price)}</td><td class="num">${fmtPct(c.price_change_percentage_24h||0)}</td><td class="num">${fmtCap(c.market_cap)}</td></tr>`).join('')}</tbody></table>`;
    }

    function synthUpdate(){
      return fallback.map(c=>{const drift=(Math.random()-0.5)*1.8; const p=Math.max(0.0001,c.current_price*(1+drift/100)); return {...c,current_price:p,price_change_percentage_24h:(c.price_change_percentage_24h||0)+drift*0.4};});
    }

    async function fetchTop10(){
      const r=await fetch(endpoint,{cache:'no-store'});
      if(r.status===429) throw new Error('RATE_LIMIT');
      if(!r.ok) throw new Error('API_FAIL');
      const d=await r.json(); if(!Array.isArray(d)) throw new Error('BAD_PAYLOAD'); return d;
    }

    function setNext(){ if(pollTimer)clearTimeout(pollTimer); pollTimer=setTimeout(runCycle,refreshMs); }

    async function runCycle(){
      try{
        const data=await fetchTop10();
        renderTable(data);
        cgStatus.textContent='CoinGecko: live';
        refreshMs=BASE_MS;
      }catch(e){
        const fake=synthUpdate();
        renderTable(fake);
        cgStatus.textContent='CoinGecko: fallback live (API limited)';
        refreshMs=Math.min(refreshMs*2,MAX_MS);
      }
      lastSync.textContent='Last sync: '+new Date().toLocaleTimeString();
      setNext();
    }


    const pool=[
      {title:'AI Coins',desc:'AI momentum rotates back into high-beta Solana names on increased social + volume velocity.',tokens:['$AI16Z','$ALCH','$WAI'],sentiment:'Bullish',strength:4},
      {title:'Memecoins',desc:'Meme sector still leads intraday attention with quick rotation and heavy mindshare spikes.',tokens:['$BONK','$WIF','$MYRO'],sentiment:'Neutral',strength:3},
      {title:'DePIN',desc:'Compute and physical infra stories show steady bid as long-term thesis regains flow.',tokens:['$RENDER','$IO','$HNT'],sentiment:'Bullish',strength:4},
      {title:'Gaming',desc:'Selective gaming tokens are stabilizing with ecosystem launches and new player quests.',tokens:['$ATLAS','$POLIS','$AURY'],sentiment:'Neutral',strength:2},
      {title:'RWA',desc:'RWA narrative grows on headlines, but liquidity remains concentrated in a few names.',tokens:['$ONDO','$MPL','$CFG'],sentiment:'Neutral',strength:2},
      {title:'Perp DEX',desc:'Perp infra narratives rebound as traders search on-chain alternatives for leverage exposure.',tokens:['$JUP','$DRIFT','$ZETA'],sentiment:'Bearish',strength:2}
    ];
    const sCls=s=>s==='Bullish'?'bull':s==='Bearish'?'bear':'neutral';
    const shuffle=a=>a.map(v=>[Math.random(),v]).sort((x,y)=>x[0]-y[0]).map(x=>x[1]);
    const mutate=n=>{let strength=Math.max(1,Math.min(5,n.strength+(Math.random()>.7?1:Math.random()<.2?-1:0)));let sentiment=n.sentiment;if(Math.random()>.85)sentiment=sentiment==='Bullish'?'Neutral':'Bullish';return {...n,strength,sentiment}};
    let nCountdown=12;
    function rotateNarratives(){
      const items=shuffle(pool).slice(0,5).map(mutate);
      narrativesEl.innerHTML=items.map(n=>`<article class="n-card"><div class="n-title">${n.title}</div><div class="n-desc">${n.desc}</div><div class="tokens">${n.tokens.map(t=>`<span class="token">${t}</span>`).join('')}</div><div class="meta"><span class="sent ${sCls(n.sentiment)}">${n.sentiment}</span><span class="strength">${'ðŸ”¥'.repeat(n.strength)}</span></div></article>`).join('');
      nCountdown=10+Math.floor(Math.random()*11); narrativeTick.textContent=`Next rotation: ${nCountdown}s`;
    }
    setInterval(()=>{nCountdown--; if(nCountdown<=0) rotateNarratives(); narrativeTick.textContent=`Next rotation: ${Math.max(0,nCountdown)}s`;},1000);

    rotateNarratives(); runCycle();
  </script>
</body>
</html>